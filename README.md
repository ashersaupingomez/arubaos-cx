# arubaos-cx

Superagent utilities for interacting with the ArubaOS-CX REST API

## Features

-   Tested & working on REST API versions v1 & v10.04
-   Based on [superagent.agent](https://visionmedia.github.io/superagent/#agents-for-global-state), a simple & robust http client class with in-built cookie handling.
-   Simple & flexible API with minimal moving parts.
-   Works with environment variables, by default.
-   Super-lightweight package.

## Getting Started

```javascript
const { useClient } = require('arubaos-cx');

function requestGetPlatformName(client) {
  return client
    .get('/system')
    .query({ attributes: 'platform_name' });
}

useClient(requestGetPlatformName)
  .then(console.log)
  .catch(console.error);
```

## API

<!-- Generated by documentation.js. Update this documentation by updating the source code. -->

#### Table of Contents

-   [createClient](#createclient)
    -   [Parameters](#parameters)
    -   [Examples](#examples)
-   [useClient](#useclient)
    -   [Parameters](#parameters-1)
    -   [Examples](#examples-1)

### createClient

Request URLs are prepended with the appropriate URL base,
so only REST API endpoints are required.

#### Parameters

-   `host` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** Switch IP address (typically) (optional, default `process.env.ARUBA_OS_CX_HOST!`)
-   `version` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** ArubaOS-CX REST API version (optional, default `process.env.ARUBA_OS_CX_VERSION||'v1'`)

#### Examples

```javascript
const client = createClient();
```

If certs hasn't been configured on the switch


```javascript
const client = createClient()
  .disableTLSCerts();
```

Returns **any** ArubaOS-CX REST API client

### useClient

#### Parameters

-   `fn` **function (client: any): [Promise](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Promise)&lt;T>** Function whose only parameter is `client`
-   `client` **any** ArubaOS-CX REST API client (optional, default `createClient()`)
-   `username` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** Switch username (optional, default `process.env.ARUBA_OS_CX_USERNAME||'admin'`)
-   `password` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** Switch password (optional, default `process.env.ARUBA_OS_CX_PASSWORD||''`)

#### Examples

First, define a function which accepts & uses the `client` paramter


```javascript
function requestGetPlatformName(client) {
  return client
    .get('/system')
    .query({ attributes: 'platform_name' });
}
```

Then, use the `useClient` function which returns the resolved value of `fn`


```javascript
const response = await useClient(requestGetPlatformName);
```

Returns **[Promise](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Promise)&lt;T>** Promise that resolves to the return value of `fn`

## Testing

Tests are performed on an actual ArubaOS-CX switch whose credentials are defined by environment variables.
These can be fed either via the command line or a `.env` file at the root of this package.

```bash
$ npm test
```
